name: Daily Push Notification

on:
  schedule:
    # Every day at 6:00 AM UTC (7:00 AM Paris winter / 8:00 AM Paris summer)
    - cron: '0 6 * * *'
    # Every day at 12:00 PM UTC (1:00 PM / 2:00 PM Paris)
    - cron: '0 12 * * *'
    # Every day at 8:00 PM UTC (9:00 PM / 10:00 PM Paris)
    - cron: '0 20 * * *'
  workflow_dispatch:

jobs:
  send-notification:
    runs-on: ubuntu-latest
    steps:
      - name: Send push notification via OneSignal
        run: |
          HOUR=$(date -u +%H)
          if [ "$HOUR" = "06" ]; then
            MSG="Bonjour ! N'oubliez pas votre lecture du Coran aujourd'hui."
          elif [ "$HOUR" = "12" ]; then
            MSG="C'est le moment id√©al pour lire quelques versets du Coran."
          else
            MSG="Avez-vous lu vos versets aujourd'hui ? Il est encore temps."
          fi

          curl -s -X POST https://onesignal.com/api/v1/notifications \
            -H "Content-Type: application/json; charset=utf-8" \
            -H "Authorization: Basic ${{ secrets.ONESIGNAL_REST_API_KEY }}" \
            -d "{
              \"app_id\": \"${{ secrets.ONESIGNAL_APP_ID }}\",
              \"included_segments\": [\"Subscribed Users\"],
              \"contents\": {\"fr\": \"$MSG\", \"en\": \"$MSG\"},
              \"headings\": {\"fr\": \"Qurani\", \"en\": \"Qurani\"},
              \"url\": \"https://tmshparis.github.io/ayat/\"
            }"
